<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Puls — Credit Report (Demo)</title>
  <style>
    :root { font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; color: #111827; }
    body { margin:0; background:#f7fafc; }
    a { color: #111827; text-decoration: none; }
    .wrap { max-width:1100px; margin:0 auto; padding:18px; }
    header.top { position:sticky; top:0; z-index:50; backdrop-filter: blur(6px); background:rgba(255,255,255,0.7); border-bottom:1px solid #e5e7eb; }
    .topbar { display:flex; align-items:center; justify-content:space-between; gap:12px; padding:12px 0; }
    h1 { margin:0; font-size:18px; font-weight:700; }
    nav a { font-size:14px; margin:0 10px; }
    nav a.active { text-decoration: underline; }
    .panel { background:white; border-radius:12px; padding:16px; box-shadow:0 6px 18px rgba(15,23,42,0.06); border:1px solid rgba(2,6,23,0.04); }
    .grid { display:grid; gap:12px; }
    .grid.cols2 { grid-template-columns: 1fr 360px; align-items:start; }
    label { display:block; font-size:13px; color:#6b7280; margin:12px 0 6px; }
    input[type="number"], input[type="text"], select { width:100%; padding:10px 12px; border-radius:8px; border:1px solid #e5e7eb; font-size:15px; box-sizing:border-box; background:white; }
    .row { display:flex; gap:8px; align-items:center; flex-wrap: wrap; }
    button { padding:10px 14px; border-radius:10px; border:0; cursor:pointer; font-weight:600; }
    .btn-primary { background:#4f46e5; color:white; }
    .btn-ghost { background:transparent; color:#374151; border:1px solid #e5e7eb; }
    .muted { color:#6b7280; font-size:13px; }
    .stat { font-size:18px; font-weight:700; }
    ul.tips { padding-left:18px; margin:8px 0 0; color:#374151; }
    footer.site { border-top:1px solid #e5e7eb; margin-top:26px; padding:16px 0; font-size:13px; color:#6b7280; display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:10px;}
    .section { margin:18px 0; }
    .h2 { font-size:22px; font-weight:700; margin:0 0 8px; }
    .list { font-size:15px; color:#374151; }
    .list li { margin:6px 0; }
    .hero { display:grid; grid-template-columns:1fr 1fr; gap:16px; align-items:center; }
    @media (max-width: 880px) { .grid.cols2 { grid-template-columns: 1fr; } .hero { grid-template-columns: 1fr; } }
  </style>
  <!-- React + ReactDOM + Babel (для JSX без сборки) -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <!-- PDF libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<body>
  <div id="root"></div>
  <h1 style="color: red;">Hello from Puls</h1>

  <script type="text/babel">
  const { useState, useMemo, useEffect } = React;

  // ===== Router (hash-based) =====
  const routes = ["home","form","report","how","data","security","imprint","privacy"];
  function parseHash() {
    const h = (location.hash || "").replace(/^#\\/?/, "");
    const [view, ...rest] = h.split("/");
    return routes.includes(view) ? view : "home";
  }

  // ===== Helpers (scoring) =====
  function scale(v, min, max) { return (v - min) / (max - min); }
  function clamp(v, a, b) { return Math.min(b, Math.max(a, v)); }
  function computeRunway(d) { const burn = Math.max(0, d.monthlyExpenses - d.monthlyRevenue); return burn<=0?24:d.avgBankBalance/burn; }
  function computeMargin(d) { return d.monthlyRevenue<=0?0:Math.max(0,(d.monthlyRevenue-d.monthlyExpenses)/d.monthlyRevenue); }
  function computeScore(d) {
    const runway = computeRunway(d), margin = computeMargin(d);
    const liquidity = clamp(scale(runway,0,12)*100,0,100);
    const profitability = clamp(margin*100,0,100);
    const paymentHistory = clamp(100 - d.missedPaymentsLast12M*25,0,100);
    const leverage = clamp(100 - d.creditUtilizationPct,0,100);
    const age = clamp(scale(d.foundedMonthsAgo,0,36)*100,0,100);
    const total0to100 = liquidity*0.28 + profitability*0.27 + paymentHistory*0.23 + leverage*0.12 + age*0.10;
    return { total: Math.round(total0to100*9), liquidity, profitability, paymentHistory, leverage, age };
  }
  function gradeFromScore(t){ if(t>=800)return"A+"; if(t>=740)return"A"; if(t>=680)return"B+"; if(t>=620)return"B"; if(t>=560)return"C+"; if(t>=500)return"C"; return"D"; }
  function gradeLabel(g){ switch(g){case"A+":return"excellent";case"A":return"very good";case"B+":return"good";case"B":return"fair";case"C+":return"watchlist";case"C":return"weak";default:return"high risk";} }
  function getRecommendations(d,s){
    const tips=[]; const m=computeMargin(d), r=computeRunway(d);
    if(m<0.15) tips.push("Improve gross margin to 20%+");
    if(r<3) tips.push("Boost liquidity: target 3–6 months runway");
    if(d.missedPaymentsLast12M>0) tips.push("Avoid missed payments for 12 months");
    if(d.creditUtilizationPct>40) tips.push("Lower credit utilization below 30%");
    if(d.activeLoans>2) tips.push("Consider consolidating loans");
    if(tips.length===0) tips.push("Stay the course: margins healthy, utilization low");
    return tips;
  }

  // ===== App =====
  function App() {
    const [view, setView] = useState(parseHash());
    const [data,setData] = useState({
      companyName:"",legalForm:"UG",foundedMonthsAgo:18,monthlyRevenue:25000,monthlyExpenses:18000,
      avgBankBalance:12000,missedPaymentsLast12M:0,creditUtilizationPct:22,activeLoans:0,industry:"Services"
    });

    useEffect(() => {
      const onHash = () => setView(parseHash());
      window.addEventListener("hashchange", onHash);
      return () => window.removeEventListener("hashchange", onHash);
    }, []);

    const score = useMemo(()=>computeScore(data),[data]);
    const grade = useMemo(()=>gradeFromScore(score.total),[score.total]);
    const runway = useMemo(()=>computeRunway(data),[data]);
    const margin = useMemo(()=>computeMargin(data),[data]);
    const tips = useMemo(()=>getRecommendations(data,score),[data,score]);

    function go(v){ location.hash = `#/${v}`; }

    return (
      <div>
        <header className="top">
          <div className="wrap topbar">
            <button className="btn-ghost" onClick={()=>go("home")}><h1>Puls | Credit Report</h1></button>
            <nav>
              <a href="#/how" className={view==="how"?"active":""}>How it works</a>
              <a href="#/data" className={view==="data"?"active":""}>Data used</a>
              <a href="#/security" className={view==="security"?"active":""}>Security</a>
            </nav>
          </div>
        </header>

        <main className="wrap">
          {view==="home" && <Home go={go} />}

          {view==="form" && (
            <section>
              <h2 className="h2">Start with your numbers</h2>
              <div className="grid cols2 section">
                <div className="panel">
                  <Form data={data} setData={setData} />
                  <div className="row" style={{marginTop:12}}>
                    <button className="btn-primary" onClick={()=>go("report")}>Generate report</button>
                    <button className="btn-ghost" onClick={()=>{
                      setData({
                        companyName:"Demo GmbH",legalForm:"GmbH",foundedMonthsAgo:18,monthlyRevenue:25000,monthlyExpenses:18000,
                        avgBankBalance:12000,missedPaymentsLast12M:0,creditUtilizationPct:22,activeLoans:0,industry:"Services"
                      });
                    }}>Load example</button>
                  </div>
                  <p className="muted" style={{marginTop:8}}>Tip: меняй цифры — отчёт пересчитается.</p>
                </div>
                <div className="panel">
                  <MiniPreview score={score} grade={grade} runway={runway} margin={margin} data={data} />
                </div>
              </div>
            </section>
          )}

          {view==="report" && (
            <section>
              <div className="row" style={{justifyContent:'space-between'}}>
                <button className="btn-ghost" onClick={()=>go("form")}>← Edit data</button>
                <button className="btn-ghost" id="btn-download-pdf">Download PDF</button>
              </div>
              <div id="report-area" className="section">
                <Report score={score} grade={grade} runway={runway} margin={margin} data={data} tips={tips} />
              </div>
              <div className="panel muted" style={{marginTop:12}}>Client-side demo. Data stays in your browser.</div>
            </section>
          )}

          {view==="how" && <How go={go} />}
          {view==="data" && <DataUsed />}
          {view==="security" && <Security />}
          {view==="imprint" && <Imprint />}
          {view==="privacy" && <Privacy />}

          <footer className="site">
            <div>© <span id="y"></span> Puls. Demo only. Not financial advice.</div>
            <div className="row">
              <a href="#/imprint">Imprint</a>
              <a href="#/privacy">Privacy</a>
            </div>
          </footer>
        </main>
      </div>
    );
  }

  // ===== Sections =====
  function Home({go}) {
    return (
      <section className="hero" style={{marginTop:18}}>
        <div>
          <h2 className="h2">Instant, human-friendly credit report for your business</h2>
          <p className="muted">Paste your numbers → get a clear score, key metrics, and concrete next steps. Designed to plug into the Puls product later.</p>
          <div className="row" style={{marginTop:12}}>
            <button className="btn-primary" onClick={()=>go("form")}>Start with your numbers</button>
            <a className="btn-ghost" href="#/how">See how it works</a>
          </div>
          <p className="muted" style={{marginTop:6}}>No signup. Sample data pre-filled.</p>
        </div>
        <div className="panel">
          <div className="muted">Credit grade</div>
          <div style={{marginTop:6}}>Preview card — open the form to try it.</div>
        </div>
      </section>
    );
  }

  function Form({data,setData}) {
    const set = (k,v)=>setData(prev=>({...prev,[k]:v}));
    return (
      <div>
        <label>Company name</label>
        <input type="text" value={data.companyName} onChange={e=>set("companyName",e.target.value)} placeholder="Acme GmbH"/>
        <label>Legal form</label>
        <select value={data.legalForm} onChange={e=>set("legalForm",e.target.value)}>
          <option>UG</option><option>GmbH</option><option>Einzelunternehmen</option><option>GbR</option>
        </select>
        <label>Founded (months ago)</label>
        <input type="number" value={data.foundedMonthsAgo} onChange={e=>set("foundedMonthsAgo",Number(e.target.value||0))}/>
        <label>Monthly revenue (€)</label>
        <input type="number" value={data.monthlyRevenue} onChange={e=>set("monthlyRevenue",Number(e.target.value||0))}/>
        <label>Monthly expenses (€)</label>
        <input type="number" value={data.monthlyExpenses} onChange={e=>set("monthlyExpenses",Number(e.target.value||0))}/>
        <label>Average bank balance (€)</label>
        <input type="number" value={data.avgBankBalance} onChange={e=>set("avgBankBalance",Number(e.target.value||0))}/>
        <label>Missed payments (12m)</label>
        <input type="number" value={data.missedPaymentsLast12M} onChange={e=>set("missedPaymentsLast12M",Number(e.target.value||0))}/>
        <label>Credit utilization (%)</label>
        <input type="number" value={data.creditUtilizationPct} onChange={e=>set("creditUtilizationPct",Number(e.target.value||0))}/>
        <label>Active loans</label>
        <input type="number" value={data.activeLoans} onChange={e=>set("activeLoans",Number(e.target.value||0))}/>
        <label>Industry</label>
        <input type="text" value={data.industry} onChange={e=>set("industry",e.target.value)}/>
      </div>
    );
  }

  function MiniPreview({score,grade,runway,margin,data}) {
    return (
      <div>
        <div className="muted">Live preview</div>
        <div style={{display:'flex',justifyContent:'space-between',marginTop:8}}>
          <div>
            <div className="stat">{score.total}</div>
            <div className="muted">Grade: <b>{grade}</b> — {gradeLabel(grade)}</div>
          </div>
          <div style={{textAlign:'right'}}>
            <div className="muted">Runway</div>
            <div className="stat">{runway.toFixed(1)} mo</div>
          </div>
        </div>
        <hr style={{margin:'12px 0'}}/>
        <div>Profit margin: <b>{Math.round(margin*100)}%</b></div>
        <div>Missed payments: <b>{data.missedPaymentsLast12M}</b></div>
        <div>Utilization: <b>{data.creditUtilizationPct}%</b></div>
      </div>
    );
  }

  function Report({score, grade, runway, margin, data, tips}) {
    return (
      <div className="grid cols2">
        <div className="panel">
          <div className="muted">Credit score</div>
          <div style={{display:'flex',justifyContent:'space-between',marginTop:8}}>
            <div>
              <div className="stat">{score.total}</div>
              <div className="muted">Grade: <b>{grade}</b> — {gradeLabel(grade)}</div>
            </div>
            <div style={{textAlign:'right'}}>
              <div className="muted">Runway</div>
              <div className="stat">{runway.toFixed(1)} mo</div>
            </div>
          </div>
          <hr style={{margin:'12px 0'}}/>
          <div>Company: <b>{data.companyName || "—"}</b></div>
          <div>Legal form: <b>{data.legalForm}</b></div>
          <div>Industry: <b>{data.industry || "—"}</b></div>
          <hr style={{margin:'12px 0'}}/>
          <div>Profit margin: <b>{Math.round(margin*100)}%</b></div>
          <div>Missed payments: <b>{data.missedPaymentsLast12M}</b></div>
          <div>Credit utilization: <b>{data.creditUtilizationPct}%</b></div>
        </div>
        <div className="panel">
          <div className="muted">Recommendations</div>
          <ul className="tips">{tips.map((t,i)=><li key={i}>{t}</li>)}</ul>
          <hr style={{margin:'12px 0'}}/>
          <div className="muted">Partner offers (demo): b’steuern, SureIn</div>
        </div>
      </div>
    );
  }

  function How({go}) {
    return (
      <section className="panel section">
        <h2 className="h2">How it works</h2>
        <ol className="list" style={{paddingLeft:18}}>
          <li><b>Provide inputs.</b> Revenue, expenses, bank balance, age, missed payments, utilization.</li>
          <li><b>Local scoring.</b> Everything is computed in your browser (no server calls in this demo).</li>
          <li><b>Composite score.</b> 0–900 across liquidity, profitability, payment history, leverage, age.</li>
          <li><b>Readable report.</b> Grade, runway, ratios, short explanation.</li>
          <li><b>Actionable tips.</b> Simple recommendations to improve.</li>
          <li><b>Integrate later.</b> In Puls, connect bank feeds and export/share.</li>
        </ol>
        <div className="row" style={{marginTop:10}}>
          <button className="btn-primary" onClick={()=>go("form")}>Start with your numbers</button>
        </div>
      </section>
    );
  }

  function DataUsed() {
    return (
      <section className="panel section">
        <h2 className="h2">Data used</h2>
        <ul className="list">
          <li><b>Financials:</b> Monthly revenue, Monthly expenses, Average bank balance</li>
          <li><b>Credit profile:</b> Missed payments (12m), Credit utilization (%), Active loans (count)</li>
          <li><b>Context:</b> Legal form, Industry, Company age (months)</li>
          <li><b>Derived:</b> Profit margin, Cash runway, Composite score & grade</li>
        </ul>
        <p className="muted" style={{marginTop:8}}>In this prototype, all data stays in your browser.</p>
      </section>
    );
  }

  function Security() {
    return (
      <section className="panel section">
        <h2 className="h2">Security</h2>
        <ul className="list">
          <li><b>Local-only demo:</b> All calculations client-side; no data transmitted.</li>
          <li><b>Future:</b> TLS in transit, AES-256 at rest, role-based access.</li>
          <li><b>Minimization:</b> Collect only fields needed for scoring.</li>
          <li><b>GDPR-first:</b> Consent, purpose limitation, retention controls.</li>
        </ul>
      </section>
    );
  }

  function Imprint() {
    return (
      <section className="panel section">
        <h2 className="h2">Imprint</h2>
        <p><b>Puls GmbH</b><br/>Sample Street 12, 10115 Berlin, Germany</p>
        <p>Managing Director: D. Danilevich</p>
        <p>Contact: hello@puls.example</p>
        <p>Register Court: Amtsgericht Berlin • HRB 000000 • VAT ID: DE000000000</p>
        <p className="muted">This website is a demo and does not constitute financial advice.</p>
      </section>
    );
  }

  function Privacy() {
    return (
      <section className="panel section">
        <h2 className="h2">Privacy Policy</h2>
        <p><b>Scope.</b> This prototype does not send any personal data to a server.</p>
        <p><b>Data you enter.</b> Used only to render your report; reload clears it.</p>
        <p><b>Cookies & tracking.</b> No analytics or third-party trackers in this demo.</p>
        <p><b>Your rights.</b> In the full product: access, rectification, deletion, portability (GDPR).</p>
        <p><b>Contact.</b> privacy@puls.example</p>
      </section>
    );
  }

  // Mount
  ReactDOM.createRoot(document.getElementById('root')).render(<App />);

  // Year in footer
  document.getElementById('y').textContent = new Date().getFullYear();

  // PDF Download Handler (на экране Report)
  window.addEventListener('hashchange', attachPdfHandler);
  window.addEventListener('load', attachPdfHandler);
  function attachPdfHandler(){
    const btn = document.getElementById('btn-download-pdf');
    if (!btn) return;
    btn.onclick = () => {
      const el = document.getElementById('report-area');
      if (!el) return;
      const now=new Date();const pad=n=>String(n).padStart(2,'0');
      const fname=`Puls_Credit_Report_${now.getFullYear()}-${pad(now.getMonth()+1)}-${pad(now.getDate())}_${pad(now.getHours())}${pad(now.getMinutes())}.pdf`;
      const opt={ margin:[10,10,10,10], filename:fname,
        image:{type:'jpeg',quality:0.98},
        html2canvas:{scale:2,useCORS:true},
        jsPDF:{unit:'mm',format:'a4',orientation:'portrait'} };
      html2pdf().set(opt).from(el).save();
    };
  }
  </script>
</body>
</html>
