<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Puls — Credit Report (Demo)</title>
  <style>
    :root { font-family: Inter, system-ui, -apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial; color:#111827; }
    body { margin:0; background:#f7fafc; }
    a { color:#111827; text-decoration:none; }
    .wrap { max-width:1100px; margin:0 auto; padding:18px; }
    header.top { position:sticky; top:0; z-index:50; backdrop-filter:blur(6px); background:rgba(255,255,255,0.7); border-bottom:1px solid #e5e7eb; }
    .topbar { display:flex; align-items:center; justify-content:space-between; gap:12px; padding:12px 0; }
    h1 { margin:0; font-size:18px; font-weight:700; }
    nav a { font-size:14px; margin:0 10px; }
    nav a.active { text-decoration:underline; }
    .panel { background:white; border-radius:12px; padding:16px; box-shadow:0 6px 18px rgba(15,23,42,.06); border:1px solid rgba(2,6,23,.04); }
    .grid { display:grid; gap:12px; }
    .cols2 { grid-template-columns:1fr 360px; align-items:start; }
    label { display:block; font-size:13px; color:#6b7280; margin:12px 0 6px; }
    input[type="number"], input[type="text"], select { width:100%; padding:10px 12px; border-radius:8px; border:1px solid #e5e7eb; font-size:15px; background:white; box-sizing:border-box; }
    .row { display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
    button { padding:10px 14px; border-radius:10px; border:0; cursor:pointer; font-weight:600; }
    .btn-primary { background:#4f46e5; color:white; }
    .btn-ghost { background:transparent; color:#374151; border:1px solid #e5e7eb; }
    .muted { color:#6b7280; font-size:13px; }
    .stat { font-size:18px; font-weight:700; }
    ul.tips { padding-left:18px; margin:8px 0 0; color:#374151; }
    footer.site { border-top:1px solid #e5e7eb; margin-top:26px; padding:16px 0; font-size:13px; color:#6b7280; display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:10px;}
    .section { margin:18px 0; }
    .h2 { font-size:22px; font-weight:700; margin:0 0 8px; }
    .hero { display:grid; grid-template-columns:1fr 1fr; gap:16px; align-items:center; }
    @media (max-width: 880px) { .cols2 { grid-template-columns:1fr; } .hero { grid-template-columns:1fr; } }
    .hidden { display:none !important; }
  </style>
  <!-- PDF libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<body>
<header class="top">
  <div class="wrap topbar">
    <button class="btn-ghost" onclick="go('home')"><h1>Puls | Credit Report</h1></button>
    <nav>
      <a href="#/how" id="nav-how">How it works</a>
      <a href="#/data" id="nav-data">Data used</a>
      <a href="#/security" id="nav-security">Security</a>
    </nav>
  </div>
</header>

<main class="wrap">
  <!-- HOME -->
  <section id="view-home" class="section">
    <div class="hero">
      <div>
        <h2 class="h2">Instant, human-friendly credit report for your business</h2>
        <p class="muted">Paste your numbers → get a clear score, key metrics, and next steps. Everything runs in your browser.</p>
        <div class="row" style="margin-top:12px">
          <button class="btn-primary" onclick="go('form')">Start with your numbers</button>
          <a class="btn-ghost" href="#/how">See how it works</a>
        </div>
        <p class="muted" style="margin-top:6px">No signup. Sample data pre-filled.</p>
      </div>
      <div class="panel"><div class="muted">Preview card — open the form to try it.</div></div>
    </div>
  </section>

  <!-- FORM -->
  <section id="view-form" class="section hidden">
    <h2 class="h2">Start with your numbers</h2>
    <div class="grid cols2">
      <div class="panel">
        <label>Company name</label><input id="f-companyName" type="text" placeholder="Acme GmbH"/>
        <label>Legal form</label>
        <select id="f-legalForm">
          <option>UG</option><option>GmbH</option><option>Einzelunternehmen</option><option>GbR</option>
        </select>
        <label>Founded (months ago)</label><input id="f-foundedMonthsAgo" type="number"/>
        <label>Monthly revenue (€)</label><input id="f-monthlyRevenue" type="number"/>
        <label>Monthly expenses (€)</label><input id="f-monthlyExpenses" type="number"/>
        <label>Average bank balance (€)</label><input id="f-avgBankBalance" type="number"/>
        <label>Missed payments (12m)</label><input id="f-missedPaymentsLast12M" type="number"/>
        <label>Credit utilization (%)</label><input id="f-creditUtilizationPct" type="number"/>
        <label>Active loans</label><input id="f-activeLoans" type="number"/>
        <label>Industry</label><input id="f-industry" type="text"/>

        <div class="row" style="margin-top:12px">
          <button class="btn-primary" onclick="go('report')">Generate report</button>
          <button class="btn-ghost" onclick="loadExample()">Load example</button>
        </div>
        <p class="muted" style="margin-top:8px">Tip: меняй цифры — отчёт на странице «Report» пересчитается.</p>
      </div>

      <div class="panel">
        <div class="muted">Live preview</div>
        <div style="display:flex;justify-content:space-between;margin-top:8px">
          <div>
            <div class="stat" id="prev-score">—</div>
            <div class="muted">Grade: <b id="prev-grade">—</b> — <span id="prev-gradeLabel">—</span></div>
          </div>
          <div style="text-align:right">
            <div class="muted">Runway</div>
            <div class="stat" id="prev-runway">—</div>
          </div>
        </div>
        <hr style="margin:12px 0"/>
        <div>Profit margin: <b id="prev-margin">—</b></div>
        <div>Missed payments: <b id="prev-missed">—</b></div>
        <div>Utilization: <b id="prev-util">—</b></div>
      </div>
    </div>
  </section>

  <!-- REPORT -->
  <section id="view-report" class="section hidden">
    <div class="row" style="justify-content:space-between">
      <button class="btn-ghost" onclick="go('form')">← Edit data</button>
      <button class="btn-ghost" id="btn-download-pdf">Download PDF</button>
    </div>
    <div id="report-area" class="section">
      <div class="grid cols2">
        <div class="panel">
          <div class="muted">Credit score</div>
          <div style="display:flex;justify-content:space-between;margin-top:8px">
            <div>
              <div class="stat" id="r-score">—</div>
              <div class="muted">Grade: <b id="r-grade">—</b> — <span id="r-gradeLabel">—</span></div>
            </div>
            <div style="text-align:right">
              <div class="muted">Runway</div>
              <div class="stat" id="r-runway">—</div>
            </div>
          </div>
          <hr style="margin:12px 0"/>
          <div>Company: <b id="r-company">—</b></div>
          <div>Legal form: <b id="r-legal">—</b></div>
          <div>Industry: <b id="r-industry">—</b></div>
          <hr style="margin:12px 0"/>
          <div>Profit margin: <b id="r-margin">—</b></div>
          <div>Missed payments: <b id="r-missed">—</b></div>
          <div>Credit utilization: <b id="r-util">—</b></div>
        </div>
        <div class="panel">
          <div class="muted">Recommendations</div>
          <ul class="tips" id="r-tips"></ul>
          <hr style="margin:12px 0"/>
          <div class="muted">Partner offers (demo): b’steuern, SureIn</div>
        </div>
      </div>
    </div>
    <div class="panel muted" style="margin-top:12px">Client-side demo. Data stays in your browser.</div>
  </section>

  <!-- HOW -->
  <section id="view-how" class="panel section hidden">
    <h2 class="h2">How it works</h2>
    <ol style="padding-left:18px; color:#374151">
      <li><b>Provide inputs.</b> Revenue, expenses, bank balance, age, missed payments, utilization.</li>
      <li><b>Local scoring.</b> Everything is computed in your browser (no server calls).</li>
      <li><b>Composite score.</b> 0–900 across liquidity, profitability, payment history, leverage, age.</li>
      <li><b>Readable report.</b> Grade, runway, ratios, explanation.</li>
      <li><b>Actionable tips.</b> Simple recommendations to improve.</li>
      <li><b>Integrate later.</b> In Puls, connect bank feeds and export/share.</li>
    </ol>
    <div class="row" style="margin-top:10px"><button class="btn-primary" onclick="go('form')">Start with your numbers</button></div>
  </section>

  <!-- DATA -->
  <section id="view-data" class="panel section hidden">
    <h2 class="h2">Data used</h2>
    <ul style="color:#374151">
      <li><b>Financials:</b> Monthly revenue, Monthly expenses, Average bank balance</li>
      <li><b>Credit profile:</b> Missed payments (12m), Credit utilization (%), Active loans (count)</li>
      <li><b>Context:</b> Legal form, Industry, Company age (months)</li>
      <li><b>Derived:</b> Profit margin, Cash runway, Composite score & grade</li>
    </ul>
    <p class="muted" style="margin-top:8px">In this prototype, all data stays in your browser.</p>
  </section>

  <!-- SECURITY -->
  <section id="view-security" class="panel section hidden">
    <h2 class="h2">Security</h2>
    <ul style="color:#374151">
      <li><b>Local-only demo:</b> All calculations client-side; no data transmitted.</li>
      <li><b>Future:</b> TLS in transit, AES-256 at rest, role-based access.</li>
      <li><b>Minimization:</b> Collect only fields needed for scoring.</li>
      <li><b>GDPR-first:</b> Consent, purpose limitation, retention controls.</li>
    </ul>
  </section>

  <!-- IMPRINT -->
  <section id="view-imprint" class="panel section hidden">
    <h2 class="h2">Imprint</h2>
    <p><b>Puls GmbH</b><br/>Sample Street 12, 10115 Berlin, Germany</p>
    <p>Managing Director: D. Danilevich</p>
    <p>Contact: hello@puls.example</p>
    <p>Register Court: Amtsgericht Berlin • HRB 000000 • VAT ID: DE000000000</p>
    <p class="muted">This website is a demo and does not constitute financial advice.</p>
  </section>

  <!-- PRIVACY -->
  <section id="view-privacy" class="panel section hidden">
    <h2 class="h2">Privacy Policy</h2>
    <p><b>Scope.</b> This prototype does not send any personal data to a server.</p>
    <p><b>Data you enter.</b> Used only to render your report; reload clears it.</p>
    <p><b>Cookies & tracking.</b> No analytics or third-party trackers in this demo.</p>
    <p><b>Your rights.</b> In the full product: access, rectification, deletion, portability (GDPR).</p>
    <p><b>Contact.</b> privacy@puls.example</p>
  </section>

  <footer class="site">
    <div>© <span id="y"></span> Puls. Demo only. Not financial advice.</div>
    <div class="row">
      <a href="#/imprint">Imprint</a>
      <a href="#/privacy">Privacy</a>
    </div>
  </footer>
</main>

<script>
  // ---------- State ----------
  const state = {
    companyName: "", legalForm: "UG", foundedMonthsAgo: 18,
    monthlyRevenue: 25000, monthlyExpenses: 18000, avgBankBalance: 12000,
    missedPaymentsLast12M: 0, creditUtilizationPct: 22, activeLoans: 0,
    industry: "Services"
  };

  // ---------- Helpers (scoring) ----------
  const scale = (v, min, max) => (v - min) / (max - min);
  const clamp = (v, a, b) => Math.min(b, Math.max(a, v));
  function computeRunway(d){ const burn=Math.max(0,d.monthlyExpenses-d.monthlyRevenue); return burn<=0?24:d.avgBankBalance/burn; }
  function computeMargin(d){ return d.monthlyRevenue<=0?0:Math.max(0,(d.monthlyRevenue-d.monthlyExpenses)/d.monthlyRevenue); }
  function computeScore(d){
    const runway=computeRunway(d), margin=computeMargin(d);
    const liquidity = clamp(scale(runway,0,12)*100,0,100);
    const profitability = clamp(margin*100,0,100);
    const paymentHistory = clamp(100 - d.missedPaymentsLast12M*25,0,100);
    const leverage = clamp(100 - d.creditUtilizationPct,0,100);
    const age = clamp(scale(d.foundedMonthsAgo,0,36)*100,0,100);
    const total0to100 = liquidity*0.28 + profitability*0.27 + paymentHistory*0.23 + leverage*0.12 + age*0.10;
    return { total: Math.round(total0to100*9), liquidity, profitability, paymentHistory, leverage, age };
  }
  function gradeFromScore(t){ if(t>=800)return"A+"; if(t>=740)return"A"; if(t>=680)return"B+"; if(t>=620)return"B"; if(t>=560)return"C+"; if(t>=500)return"C"; return"D"; }
  function gradeLabel(g){ return ({'A+':'excellent','A':'very good','B+':'good','B':'fair','C+':'watchlist','C':'weak'})[g] || 'high risk'; }
  function getRecommendations(d){
    const tips=[]; const m=computeMargin(d), r=computeRunway(d);
    if(m<0.15) tips.push("Improve gross margin to 20%+");
    if(r<3) tips.push("Boost liquidity: target 3–6 months runway");
    if(d.missedPaymentsLast12M>0) tips.push("Avoid missed payments for 12 months");
    if(d.creditUtilizationPct>40) tips.push("Lower credit utilization below 30%");
    if(d.activeLoans>2) tips.push("Consider consolidating loans");
    if(!tips.length) tips.push("Stay the course: margins healthy, utilization low");
    return tips;
  }

  // ---------- DOM refs ----------
  const ids = (a)=>a.map(id=>[id,document.getElementById(id)]).reduce((o,[k,v])=>(o[k]=v,o),{});
  const el = ids([
    // form
    'f-companyName','f-legalForm','f-foundedMonthsAgo','f-monthlyRevenue','f-monthlyExpenses',
    'f-avgBankBalance','f-missedPaymentsLast12M','f-creditUtilizationPct','f-activeLoans','f-industry',
    // preview
    'prev-score','prev-grade','prev-gradeLabel','prev-runway','prev-margin','prev-missed','prev-util',
    // report
    'r-score','r-grade','r-gradeLabel','r-runway','r-company','r-legal','r-industry','r-margin','r-missed','r-util',
    // misc
    'btn-download-pdf'
  ]);

  // ---------- Bind form ----------
  function syncInputsFromState() {
    el['f-companyName'].value = state.companyName;
    el['f-legalForm'].value = state.legalForm;
    el['f-foundedMonthsAgo'].value = state.foundedMonthsAgo;
    el['f-monthlyRevenue'].value = state.monthlyRevenue;
    el['f-monthlyExpenses'].value = state.monthlyExpenses;
    el['f-avgBankBalance'].value = state.avgBankBalance;
    el['f-missedPaymentsLast12M'].value = state.missedPaymentsLast12M;
    el['f-creditUtilizationPct'].value = state.creditUtilizationPct;
    el['f-activeLoans'].value = state.activeLoans;
    el['f-industry'].value = state.industry;
  }
  function bindForm() {
    const bind = (id, fn) => el[id].addEventListener('input', (e) => { fn(e.target.value); updatePreview(); });
    bind('f-companyName', v => state.companyName = v);
    bind('f-legalForm', v => state.legalForm = v);
    bind('f-foundedMonthsAgo', v => state.foundedMonthsAgo = Number(v||0));
    bind('f-monthlyRevenue', v => state.monthlyRevenue = Number(v||0));
    bind('f-monthlyExpenses', v => state.monthlyExpenses = Number(v||0));
    bind('f-avgBankBalance', v => state.avgBankBalance = Number(v||0));
    bind('f-missedPaymentsLast12M', v => state.missedPaymentsLast12M = Number(v||0));
    bind('f-creditUtilizationPct', v => state.creditUtilizationPct = Number(v||0));
    bind('f-activeLoans', v => state.activeLoans = Number(v||0));
    bind('f-industry', v => state.industry = v);
  }

  function loadExample(){
    Object.assign(state, {
      companyName:"Demo GmbH", legalForm:"GmbH", foundedMonthsAgo:18,
      monthlyRevenue:25000, monthlyExpenses:18000, avgBankBalance:12000,
      missedPaymentsLast12M:0, creditUtilizationPct:22, activeLoans:0, industry:"Services"
    });
    syncInputsFromState();
    updatePreview();
  }

  // ---------- Preview & Report render ----------
  function updatePreview(){
    const s = computeScore(state);
    el['prev-score'].textContent = s.total;
    const g = gradeFromScore(s.total);
    el['prev-grade'].textContent = g;
    el['prev-gradeLabel'].textContent = gradeLabel(g);
    el['prev-runway'].textContent = computeRunway(state).toFixed(1) + ' mo';
    el['prev-margin'].textContent = Math.round(computeMargin(state)*100) + '%';
    el['prev-missed'].textContent = state.missedPaymentsLast12M;
    el['prev-util'].textContent = state.creditUtilizationPct + '%';
  }

  function renderReport(){
    const s = computeScore(state);
    const g = gradeFromScore(s.total);
    const runway = computeRunway(state);
    const margin = computeMargin(state);

    el['r-score'].textContent = s.total;
    el['r-grade'].textContent = g;
    el['r-gradeLabel'].textContent = gradeLabel(g);
    el['r-runway'].textContent = runway.toFixed(1) + ' mo';
    el['r-company'].textContent = state.companyName || '—';
    el['r-legal'].textContent = state.legalForm;
    el['r-industry'].textContent = state.industry || '—';
    el['r-margin'].textContent = Math.round(margin*100) + '%';
    el['r-missed'].textContent = state.missedPaymentsLast12M;
    el['r-util'].textContent = state.creditUtilizationPct + '%';

    const tipsEl = document.getElementById('r-tips');
    tipsEl.innerHTML = '';
    getRecommendations(state).forEach(t => {
      const li = document.createElement('li'); li.textContent = t; tipsEl.appendChild(li);
    });
  }

  // ---------- Router ----------
  function go(v){ location.hash = '#/'+v; }
  function currentView(){
    const h = (location.hash||'').replace(/^#\/?/, '');
    const view = h.split('/')[0];
    return ['home','form','report','how','data','security','imprint','privacy'].includes(view) ? view : 'home';
  }
  function show(view){
    // toggle active links
    ['how','data','security'].forEach(id => {
      const a = document.getElementById('nav-'+id);
      if (a) a.classList.toggle('active', view===id);
    });
    // show section
    ['home','form','report','how','data','security','imprint','privacy'].forEach(v=>{
      const sec = document.getElementById('view-'+v);
      if (sec) sec.classList.toggle('hidden', v!==view);
    });
    if(view==='form') { syncInputsFromState(); updatePreview(); }
    if(view==='report') { renderReport(); }
  }
  window.addEventListener('hashchange', ()=>show(currentView()));

  // ---------- PDF ----------
  function attachPdf(){
    const btn = document.getElementById('btn-download-pdf');
    if (!btn) return;
    btn.onclick = () => {
      const el = document.getElementById('report-area'); if(!el) return;
      const now=new Date(), pad=n=>String(n).padStart(2,'0');
      const fname=`Puls_Credit_Report_${now.getFullYear()}-${pad(now.getMonth()+1)}-${pad(now.getDate())}_${pad(now.getHours())}${pad(now.getMinutes())}.pdf`;
      const opt={ margin:[10,10,10,10], filename:fname,
        image:{type:'jpeg',quality:0.98},
        html2canvas:{scale:2,useCORS:true},
        jsPDF:{unit:'mm',format:'a4',orientation:'portrait'} };
      html2pdf().set(opt).from(el).save();
    };
  }

  // ---------- Init ----------
  document.getElementById('y').textContent = new Date().getFullYear();
  bindForm();
  loadExample(); // заполним примером сразу, можно убрать
  show(currentView());
  attachPdf();
</script>
</body>
</html>
